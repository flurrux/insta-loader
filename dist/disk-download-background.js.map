{"version":3,"sources":["disk-download-background.ts"],"names":[],"mappings":";AAiCA,IAAM,EAAiB,oBAEjB,EAAsB,SAAC,EAAS,EAAQ,GAC7C,QAAQ,IAAI,gCACZ,QAAQ,IAAI,UAAW,GACjB,IAAA,EAAW,EACb,IACG,IAAA,EAAO,OAAO,QAAQ,cAAc,GAC1C,EAAK,UAAU,YAAY,SAAA,GAC1B,QAAQ,IAAI,0BAA2B,GACvC,EAAa,CACZ,OAAQ,uBACR,KAAM,MAGR,EAAK,aAAa,YAAY,WACvB,IAAA,EAAe,OAAO,QAAQ,UAAU,QAC9C,QAAQ,IAAI,gCAAiC,GAC7C,EAAa,CACZ,OAAQ,yBACR,KAAM,MAIF,IAAA,EAAgB,KAAK,UAAU,GACrC,EAAK,YAAY,GAElB,MAAM,GAEL,YADA,QAAQ,IAAI,KAKd,OAAO,QAAQ,UAAU,YAAY,SAAU,GAC5B,oBAAd,EAAK,MACT,EAAK,UAAU,YAAY,SAAU,EAAK,GACzC,EAAoB,EAAK,EAAQ,SAAA,GAChC,EAAK,YAAY","file":"disk-download-background.js","sourceRoot":"../app/src/disk-writing","sourcesContent":["/**\r\n * Created by Christian on 15.08.2017.\r\n */\r\n\r\ninterface NativeProgressResponse {\r\n\ttype: \"progress\",\r\n\tdata: {\r\n\t\tprogress: number\r\n\t}\r\n};\r\ninterface NativeHostErrorResponse {\r\n\ttype: \"error\",\r\n\tdata: \"wrong action-key\" |\r\n\t\"wrong data-key\" |\r\n\t\"wrong link-key\" |\r\n\t\"wrong folderPath-key\" |\r\n\t\"wrong fileName-key\" |\r\n\tstring;\r\n};\r\ninterface NativeDownloadSuccessResponse {\r\n\ttype: \"success\",\r\n\tdata: string\r\n};\r\ntype NativeHostResponse = NativeHostErrorResponse |\r\n\tNativeDownloadSuccessResponse |\r\n\tNativeProgressResponse;\r\n\r\ninterface ResponseToForeground {\r\n\torigin: string,\r\n\tdata: string | NativeHostResponse\r\n};\r\n\r\n\r\nconst nativeHostName = \"insta_loader_host\";\r\n\r\nconst connectToNativeHost = (request, sender, responseFunc) => {\r\n\tconsole.log(\"connecting to native host...\");\r\n\tconsole.log(\"request\", request);\r\n\tconst hostName = nativeHostName;\r\n\ttry {\r\n\t\tconst port = chrome.runtime.connectNative(hostName);\r\n\t\tport.onMessage.addListener(message => {\r\n\t\t\tconsole.log(\"received native message\", message);\r\n\t\t\tresponseFunc({\r\n\t\t\t\torigin: \"native host response\", \r\n\t\t\t\tdata: message    \r\n\t\t\t} as ResponseToForeground);\r\n\t\t});\r\n\t\tport.onDisconnect.addListener(() => {\r\n\t\t\tconst errorMessage = chrome.runtime.lastError.message;\r\n\t\t\tconsole.log(\"disconnected from native host\", errorMessage);\r\n\t\t\tresponseFunc({\r\n\t\t\t\torigin: \"native host disconnect\", \r\n\t\t\t\tdata: errorMessage\r\n\t\t\t} as ResponseToForeground);\r\n\t\t});\r\n\r\n\t\tconst requestString = JSON.stringify(request);\r\n\t\tport.postMessage(requestString);\r\n\t}\r\n\tcatch(e){\r\n\t\tconsole.log(e);\r\n\t\treturn;\r\n\t}\r\n};\r\n\r\nchrome.runtime.onConnect.addListener(function (port) {\r\n\tif (port.name !== \"disk-downloader\") return;\r\n\tport.onMessage.addListener(function (msg, sender) {\r\n\t\tconnectToNativeHost(msg, sender, response => {\r\n\t\t\tport.postMessage(response);\r\n\t\t});\r\n\t});\r\n});"]}