chrome.runtime.onConnect.addListener((function(e){"chrome-downloader"===e.name&&(e.onDisconnect.addListener((()=>console.log("port disconnected"))),e.onMessage.addListener((async(o,t)=>{var r;if(console.log(o),"request-download"!==o.type)"request-state"===o.type&&chrome.downloads.search({id:o.id},(o=>{if(0!==o.length){o.length>1&&console.warn("more than one file for this download found. this shoud not happen");const t=o[0],r=t.state;if("interrupted"===r)return void e.postMessage({type:"error",error:t.error});if("complete"===r)return void e.postMessage({type:"success"});if("in_progress"===r)return void e.postMessage({type:"progress",progress:{bytesReceived:t.bytesReceived,totalBytes:t.totalBytes,progress:t.bytesReceived/t.totalBytes}})}else e.postMessage({type:"error",error:"download started but file not found. this may be a problem with chrome."})}));else try{const t=await(r={url:o.url,filename:o.filePath,conflictAction:"overwrite"},new Promise(((e,o)=>{chrome.downloads.download(r,(t=>{void 0===t?o(chrome.runtime.lastError.message):e(t)}))})));e.postMessage({type:"download-id",id:t})}catch(o){e.postMessage({type:"error",error:o})}})))}));