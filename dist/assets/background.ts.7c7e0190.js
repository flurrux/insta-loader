function d(e){const t=chrome.runtime.lastError;return t===void 0?e:t.message||e}const c=e=>new Promise((t,o)=>{chrome.downloads.download(e,r=>{if(r!==void 0){t(r);return}o(d("chrome.runtime.lastError is undefined. no idea what the issue is, sorry"))})});chrome.runtime.onConnect.addListener(e=>{e.name==="chrome-downloader"&&(e.onDisconnect.addListener(()=>console.log("port disconnected")),e.onMessage.addListener(async(t,o)=>{if(console.log(t),t.type==="request-download"){try{const r=await c({url:t.url,filename:t.filePath,conflictAction:"overwrite"});e.postMessage({type:"download-id",id:r})}catch(r){e.postMessage({type:"error",error:r})}return}t.type==="request-state"&&chrome.downloads.search({id:t.id},r=>{if(r.length===0){e.postMessage({type:"error",error:"download started but file not found. this may be a problem with chrome."});return}else{r.length>1&&console.warn("more than one file for this download found. this shoud not happen");const s=r[0],n=s.state;if(n==="interrupted"){e.postMessage({type:"error",error:s.error});return}if(n==="complete"){e.postMessage({type:"success"});return}if(n==="in_progress"){e.postMessage({type:"progress",progress:{bytesReceived:s.bytesReceived,totalBytes:s.totalBytes,progress:s.bytesReceived/s.totalBytes}});return}}})}))});console.log("listening for instagram API calls ...");function l(e){const t={};for(const{name:o,value:r}of e)r!==void 0&&(t[o]=r);return t}chrome.webRequest.onSendHeaders.addListener(function(e){const{tabId:t,requestHeaders:o}=e;if(!o)return;const r=o.find(a=>a.name==="X-IG-WWW-Claim");if(!r)return;const s=r.value;if(!s||s.length<2)return;const n=["X-IG-App-ID","X-IG-WWW-Claim"],i=l(o.filter(a=>n.includes(a.name)));console.log("detected valid headers",i),chrome.tabs.sendMessage(t,{requestHeaders:i})},{urls:["https://i.instagram.com/api/*"]},["requestHeaders"]);chrome.webNavigation.onHistoryStateUpdated.addListener(e=>{console.log("waking up")});
