function a(e){const r=chrome.runtime.lastError;return r===void 0?e:r.message||e}const i=e=>new Promise((r,n)=>{chrome.downloads.download(e,t=>{if(t!==void 0){r(t);return}n(a("chrome.runtime.lastError is undefined. no idea what the issue is, sorry"))})});chrome.runtime.onConnect.addListener(e=>{e.name==="chrome-downloader"&&(e.onDisconnect.addListener(()=>console.log("port disconnected")),e.onMessage.addListener(async(r,n)=>{if(console.log(r),r.type==="request-download"){try{const t=await i({url:r.url,filename:r.filePath,conflictAction:"overwrite"});e.postMessage({type:"download-id",id:t})}catch(t){e.postMessage({type:"error",error:t})}return}r.type==="request-state"&&chrome.downloads.search({id:r.id},t=>{if(t.length===0){e.postMessage({type:"error",error:"download started but file not found. this may be a problem with chrome."});return}else{t.length>1&&console.warn("more than one file for this download found. this shoud not happen");const o=t[0],s=o.state;if(s==="interrupted"){e.postMessage({type:"error",error:o.error});return}if(s==="complete"){e.postMessage({type:"success"});return}if(s==="in_progress"){e.postMessage({type:"progress",progress:{bytesReceived:o.bytesReceived,totalBytes:o.totalBytes,progress:o.bytesReceived/o.totalBytes}});return}}})}))});
