import{b as r}from"./vendor.a4e52f21.js";async function a(e,t){try{const o=await r.exports.downloads.download({url:t.url,filename:t.filePath,conflictAction:"prompt"});e.postMessage({type:"download-id",id:o})}catch(o){e.postMessage({type:"error",error:o})}}async function i(e,t){const o=await r.exports.downloads.search({id:t.id});if(o.length===0){e.postMessage({type:"error",error:"download started but file not found. this may be a problem with the browser."});return}o.length>1&&console.warn("more than one file for this download found. this should not happen");const s=o[0],n=s.state;if(n==="interrupted"){e.postMessage({type:"error",error:s.error});return}if(n==="complete"){e.postMessage({type:"success"});return}if(n==="in_progress"){e.postMessage({type:"progress",progress:{bytesReceived:s.bytesReceived,totalBytes:s.totalBytes,progress:s.bytesReceived/s.totalBytes}});return}}r.exports.runtime.onConnect.addListener(e=>{e.name==="chrome-downloader"&&(e.onDisconnect.addListener(()=>console.log("port disconnected")),e.onMessage.addListener(async(t,o)=>{if(console.log(t),t.type==="request-download"){a(e,t);return}t.type==="request-state"&&i(e,t)}))});console.log("listening for instagram API calls ...");function d(e){const{tabId:t,url:o}=e,s=/(?<=instagram\.com\/api\/v1\/media\/)\d*(?=\/info)/.exec(o);if(!s)return;const n=s[0];console.log("detected media ID!",n),r.exports.tabs.sendMessage(t,{mediaID:n})}r.exports.webRequest.onSendHeaders.addListener(function(e){d(e)},{urls:["*://i.instagram.com/api/*","*://www.instagram.com/api/*"]},["requestHeaders"]);r.exports.webNavigation.onHistoryStateUpdated.addListener(e=>{console.log("waking up")});
