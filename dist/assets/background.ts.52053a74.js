import{b as r}from"./vendor.a4e52f21.js";async function c(e,t){try{const s=await r.exports.downloads.download({url:t.url,filename:t.filePath,conflictAction:"prompt"});e.postMessage({type:"download-id",id:s})}catch(s){e.postMessage({type:"error",error:s})}}async function l(e,t){const s=await r.exports.downloads.search({id:t.id});if(s.length===0){e.postMessage({type:"error",error:"download started but file not found. this may be a problem with the browser."});return}s.length>1&&console.warn("more than one file for this download found. this should not happen");const o=s[0],n=o.state;if(n==="interrupted"){e.postMessage({type:"error",error:o.error});return}if(n==="complete"){e.postMessage({type:"success"});return}if(n==="in_progress"){e.postMessage({type:"progress",progress:{bytesReceived:o.bytesReceived,totalBytes:o.totalBytes,progress:o.bytesReceived/o.totalBytes}});return}}r.exports.runtime.onConnect.addListener(e=>{e.name==="chrome-downloader"&&(e.onDisconnect.addListener(()=>console.log("port disconnected")),e.onMessage.addListener(async(t,s)=>{if(console.log(t),t.type==="request-download"){c(e,t);return}t.type==="request-state"&&l(e,t)}))});console.log("listening for instagram API calls ...");function u(e){const t={};for(const{name:s,value:o}of e)o!==void 0&&(t[s]=o);return t}function f(e){const{tabId:t,requestHeaders:s}=e;if(!s)return;const o=s.find(a=>a.name==="X-IG-WWW-Claim");if(!o)return;const n=o.value;if(!n||n.length<2)return;const d=["X-IG-App-ID","X-IG-WWW-Claim"],i=u(s.filter(a=>d.includes(a.name)));console.log("detected valid headers",i),r.exports.tabs.sendMessage(t,{requestHeaders:i})}function p(e){const{tabId:t,url:s}=e,o=/(?<=i\.instagram\.com\/api\/v1\/media\/)\d*(?=\/info)/.exec(s);if(!o)return;const n=o[0];console.log("detected media ID!"),r.exports.tabs.sendMessage(t,{mediaID:n})}r.exports.webRequest.onSendHeaders.addListener(function(e){f(e),p(e)},{urls:["*://i.instagram.com/api/*"]},["requestHeaders"]);r.exports.webNavigation.onHistoryStateUpdated.addListener(e=>{console.log("waking up")});
